const navMenu=document.querySelector(".js-nav__menu"),navToggle=document.querySelector(".js-nav__toggle"),navClose=document.querySelector(".js-nav__close"),navLink=document.querySelectorAll(".js-nav__item");navToggle&&navToggle.addEventListener("click",(()=>{navMenu.classList.remove("hide-menu"),navMenu.classList.add("show-menu")})),navClose&&navClose.addEventListener("click",(()=>{navMenu.classList.add("hide-menu"),navMenu.classList.remove("show-menu")}));const linkAction=()=>{navMenu.classList.remove("show-menu")};navLink.forEach((e=>e.addEventListener("click",linkAction)));const url=new URL(window.location.href),successMessage=document.querySelector(".js-success-message"),searchForm=document.querySelector(".js-container__form--search"),searchSwap=document.querySelector("#swap"),searchFrom=document.querySelector("#from"),searchTo=document.querySelector("#to"),searchDiscount=document.querySelector("#discount"),searchDate=document.querySelector("#date"),searchSeats=document.querySelector("#seats");successMessage&&setTimeout((function(){successMessage&&successMessage.parentNode&&successMessage.parentNode.removeChild(successMessage)}),5e3),searchForm&&(searchSwap.addEventListener("click",(e=>{e.preventDefault();let r=document.querySelector("#from").value,t=document.querySelector("#to").value;r&&t&&(document.querySelector("#from").value=t,document.querySelector("#to").value=r)})),searchFrom.addEventListener("focus",(e=>{e.preventDefault(),searchForm.querySelector("#departure_station_error")?searchForm.querySelector("#departure_station_error").remove():searchForm.querySelector("#departure_station_empty")&&searchForm.querySelector("#departure_station_empty").remove()})),searchFrom.addEventListener("blur",(e=>{e.preventDefault(),null!=searchFrom.value&&""!=searchFrom.value||searchForm.insertAdjacentHTML("afterbegin",'<p id="departure_station_error" class="form__error">Inserisci la stazione di partenza</p>')})),searchFrom.addEventListener("keypress",(e=>{"Enter"===e.key&&(e.preventDefault(),searchTo.focus())})),searchTo.addEventListener("focus",(e=>{e.preventDefault(),searchForm.querySelector("#arrival_station_error")?searchForm.querySelector("#arrival_station_error").remove():searchForm.querySelector("#arrival_station_empty")&&searchForm.querySelector("#arrival_station_empty").remove()})),searchTo.addEventListener("blur",(e=>{e.preventDefault(),null!=searchTo.value&&""!=searchTo.value||searchForm.insertAdjacentHTML("afterbegin",'<p id="arrival_station_error" class="form__error">Inserisci la stazione di arrivo</p>')})),searchTo.addEventListener("keypress",(e=>{"Enter"===e.key&&(e.preventDefault(),searchSwap.focus())})),searchDate.addEventListener("blur",(()=>{new Date(searchDate.value)>new Date&&searchForm.querySelector("#datetime_error")?searchForm.querySelector("#datetime_error").remove():new Date(searchDate.value)<=new Date&&!searchForm.querySelector("#datetime_error")&&searchForm.insertAdjacentHTML("afterbegin",'<p id="datetime_error" class="form__error">La data e l&#39;ora devono essere maggiori o uguali a quelli attuali</p>')})),url.searchParams.get("discount_code")&&(searchDiscount.value=url.searchParams.get("discount_code")),url.searchParams.get("min_people")&&(searchSeats.value=url.searchParams.get("min_people")),searchDiscount.addEventListener("focus",(e=>{e.preventDefault(),searchForm.querySelector("#discount_error")&&searchForm.querySelector("#discount_error").remove()})),searchSeats.addEventListener("input",(e=>{e.preventDefault();let r=parseInt(searchSeats.value,10);(isNaN(r)||r<1||r>35)&&(searchSeats.value=Math.min(35,Math.max(1,r)))})));const newsCard=document.querySelectorAll(".js-news");newsCard.forEach((e=>{let r=e.querySelector(".js-news__expand"),t=e.querySelector(".js-news__content");r.addEventListener("click",(()=>{t.classList.toggle("show"),r.classList.toggle("rotate"),r.classList.contains("rotate")?r.setAttribute("aria-label","Riduci la notizia"):r.setAttribute("aria-label","Espandi la notizia")}))}));const tickets=document.querySelectorAll(".js-ticket");tickets&&tickets.forEach((e=>{const r=e.querySelector(".js-news__expand"),t=e.querySelector(".js-ticket__body"),o=e.querySelector(".js-submit");r.addEventListener("click",(()=>{t.classList.toggle("ticket__body--reduced"),r.classList.toggle("rotate"),r.classList.contains("rotate")?r.setAttribute("aria-label","Riduci il biglietto"):r.setAttribute("aria-label","Espandi il biglietto")}));const a=e.querySelector(".js-first__class"),s=e.querySelector(".js-second__class"),n=e.querySelector(".js-submit");a.addEventListener("click",(()=>{a.classList.add("ticket__class--selected"),s.classList.remove("ticket__class--selected"),n.innerHTML=`€${n.dataset.firstclass}`,n.dataset.class=1})),s.addEventListener("click",(()=>{s.classList.add("ticket__class--selected"),a.classList.remove("ticket__class--selected"),n.innerHTML=`€${n.dataset.secondclass}`,n.dataset.class=2})),o.addEventListener("click",(()=>{const r=new URLSearchParams;r.append("schedule",o.dataset.schedule),r.append("class",o.dataset.class),r.append("price",1==o.dataset.class?n.dataset.firstclass:n.dataset.secondclass),r.append("departure_time",e.querySelector(".js-departure_time").innerHTML),r.append("arrival_time",e.querySelector(".js-arrival_time").innerHTML),fetch(window.location.href,{method:"POST",body:r}).then((e=>{if(!e.ok)throw new Error("Network response was not ok.");window.location.href="./buy.php"}))}))}));const overviewButton=document.querySelector("#overview"),overviewPage=document.querySelector("#page--overview"),historyButton=document.querySelector("#history"),historyPage=document.querySelector("#page--history"),userButton=document.querySelector("#user"),userPage=document.querySelector("#page--user");function showPageUser(e,r){overviewPage.classList.add("container--hide"),historyPage.classList.add("container--hide"),userPage.classList.add("container--hide"),overviewButton.classList.remove("nav__button--current"),historyButton.classList.remove("nav__button--current"),userButton.classList.remove("nav__button--current"),r.classList.remove("container--hide"),e.classList.add("nav__button--current"),localStorage.setItem("userPage",e.id)}if(overviewButton&&historyButton&&userButton){overviewButton.addEventListener("click",(()=>showPageUser(overviewButton,overviewPage))),historyButton.addEventListener("click",(()=>showPageUser(historyButton,historyPage))),userButton.addEventListener("click",(()=>showPageUser(userButton,userPage)));const e=document.querySelector("#form--user-data"),r=e.querySelector(".js-register__form--pinfo"),t=e.querySelector(".js-register__form--pwd"),o=e.querySelector("#name"),a=e.querySelector("#surname"),s=e.querySelector("#email"),n=e.querySelector("#birthday"),l=e.querySelector("#old_password"),i=e.querySelector("#new_password"),c=e.querySelector("#rnew_password"),u=/^(?!.*\.\.)[a-zA-Z0-9]+([._]*[a-zA-Z0-9])*@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;o.addEventListener("blur",(()=>{o.value||r.querySelector("#name_error")?o.value&&r.querySelector("#name_error")&&r.querySelector("#name_error").remove():r.insertAdjacentHTML("afterbegin",'<p id="name_error" class="form__error">Inserisci il tuo nome</p>')})),a.addEventListener("blur",(()=>{a.value||r.querySelector("#surname_error")?a.value&&r.querySelector("#surname_error")&&r.querySelector("#surname_error").remove():r.insertAdjacentHTML("afterbegin",'<p id="surname_error" class="form__error">Inserisci il tuo cognome</p>')})),s.addEventListener("blur",(()=>{u.test(s.value)||r.querySelector("#email_error")?u.test(s.value)&&r.querySelector("#email_error")&&r.querySelector("#email_error").remove():r.insertAdjacentHTML("afterbegin",'<p id="email_error" class="form__error">Inserisci un indirizzo email valido</p>')})),n.addEventListener("blur",(()=>{new Date(n.value)>=new Date&&!r.querySelector("#birthday_error")?r.insertAdjacentHTML("afterbegin",'<p id="birthday_error" class="form__error">La data di nascita deve essere minore o uguale a quella attuale</p>'):new Date(n.value)<new Date&&r.querySelector("#birthday_error")&&r.querySelector("#birthday_error").remove()})),l.addEventListener("focus",(()=>{t.querySelector("#different_password_error")&&t.querySelector("#different_password_error").remove()})),l.addEventListener("blur",(()=>{i.value.length<8&&!t.querySelector("#password_len_error")?t.insertAdjacentHTML("afterbegin",'<p id="password_len_error" class="form__error">La password deve essere lunga almeno 8 caratteri</p>'):i.value.length>=8&&t.querySelector("#password_len_error")&&t.querySelector("#password_len_error").remove(),c.value!=i.value&&c.value&&!t.querySelector("#different_password_error")?t.insertAdjacentHTML("afterbegin",'<p id="different_password_error" class="form__error">Le password inserite sono differenti</p>'):c.value==i.value&&t.querySelector("#different_password_error")&&t.querySelector("#different_password_error").remove()})),i.addEventListener("focus",(()=>{t.querySelector("#different_password_error")&&t.querySelector("#different_password_error").remove()})),i.addEventListener("blur",(()=>{i.value.length<8&&!t.querySelector("#password_len_error")?t.insertAdjacentHTML("afterbegin",'<p id="password_len_error" class="form__error">La password deve essere lunga almeno 8 caratteri</p>'):i.value.length>=8&&t.querySelector("#password_len_error")&&t.querySelector("#password_len_error").remove(),c.value!=i.value&&c.value&&!t.querySelector("#different_password_error")?t.insertAdjacentHTML("afterbegin",'<p id="different_password_error" class="form__error">Le password inserite sono differenti</p>'):c.value==i.value&&t.querySelector("#different_password_error")&&t.querySelector("#different_password_error").remove()})),c.addEventListener("focus",(()=>{t.querySelector("#different_password_error")&&t.querySelector("#different_password_error").remove()})),c.addEventListener("blur",(()=>{c.value==i.value||t.querySelector("#different_password_error")?c.value==i.value&&t.querySelector("#different_password_error")&&t.querySelector("#different_password_error").remove():t.insertAdjacentHTML("afterbegin",'<p id="different_password_error" class="form__error">Le password inserite sono differenti</p>')}))}const addNewsButton=document.querySelector("#addNews"),addNewsPage=document.querySelector("#page--addNews"),addOfferButton=document.querySelector("#addOffer"),addOfferPage=document.querySelector("#page--addOffer");function showPageAdmin(e,r){addNewsPage.classList.add("container--hide"),addOfferPage.classList.add("container--hide"),addNewsButton.classList.remove("nav__button--current"),addOfferButton.classList.remove("nav__button--current"),r.classList.remove("container--hide"),e.classList.add("nav__button--current"),localStorage.setItem("adminPage",e.id)}addNewsButton&&addOfferButton&&(addNewsButton.addEventListener("click",(()=>showPageAdmin(addNewsButton,addNewsPage))),addOfferButton.addEventListener("click",(()=>showPageAdmin(addOfferButton,addOfferPage)))),window.onload=()=>{if(window.location.href.includes("adminpage")&&localStorage.getItem("adminPage")){let e=localStorage.getItem("adminPage");document.querySelector(`#${e}`).click()}else if(window.location.href.includes("userpage")&&localStorage.getItem("userPage")){let e=localStorage.getItem("userPage");document.querySelector(`#${e}`).click()}};const loginForm=document.querySelector(".js-login__form");if(loginForm){const d=loginForm.querySelector("#email"),m=loginForm.querySelector("#new_password"),_=/^(?!.*\.\.)[a-zA-Z0-9]+([._]*[a-zA-Z0-9])*@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;d.addEventListener("blur",(e=>{e.preventDefault(),_.test(d.value)||loginForm.querySelector("#email_error")?_.test(d.value)&&loginForm.querySelector("#email_error")&&loginForm.querySelector("#email_error").remove():loginForm.insertAdjacentHTML("afterbegin",'<p id="email_error" class="form__error">Inserisci un indirizzo email valido</p>')})),d.addEventListener("focus",(e=>{e.preventDefault(),m.value&&loginForm.querySelector("#login_error")&&loginForm.querySelector("#login_error").remove()})),m.addEventListener("blur",(e=>{e.preventDefault(),m.value.length<8&&!loginForm.querySelector("#password_error")?loginForm.insertAdjacentHTML("afterbegin",'<p id="password_error" class="form__error">La password deve essere lunga almeno 8 caratteri</p>'):m.value.length>=8&&loginForm.querySelector("#password_error")&&loginForm.querySelector("#password_error").remove()})),m.addEventListener("focus",(e=>{e.preventDefault(),d.value&&loginForm.querySelector("#login_error")&&loginForm.querySelector("#login_error").remove()}))}const registerForm=document.querySelector(".js-register__form");if(registerForm){const v=registerForm.querySelector(".js-register__form--pinfo"),y=registerForm.querySelector(".js-register__form--pwd"),f=registerForm.querySelector("#name"),p=registerForm.querySelector("#surname"),S=registerForm.querySelector("#email"),q=registerForm.querySelector("#birthday"),g=registerForm.querySelector("#new_password"),w=registerForm.querySelector("#rnew_password"),L=/^(?!.*\.\.)[a-zA-Z0-9]+([._]*[a-zA-Z0-9])*@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;f.addEventListener("blur",(()=>{f.value||v.querySelector("#name_error")?f.value&&v.querySelector("#name_error")&&v.querySelector("#name_error").remove():v.insertAdjacentHTML("afterbegin",'<p id="name_error" class="form__error">Inserisci il tuo nome</p>')})),p.addEventListener("blur",(()=>{p.value||v.querySelector("#surname_error")?p.value&&v.querySelector("#surname_error")&&v.querySelector("#surname_error").remove():v.insertAdjacentHTML("afterbegin",'<p id="surname_error" class="form__error">Inserisci il tuo cognome</p>')})),S.addEventListener("blur",(()=>{L.test(S.value)||v.querySelector("#email_error")?L.test(S.value)&&v.querySelector("#email_error")&&v.querySelector("#email_error").remove():v.insertAdjacentHTML("afterbegin",'<p id="email_error" class="form__error">Inserisci un indirizzo email valido</p>')})),q.addEventListener("blur",(()=>{new Date(q.value)>=new Date&&!v.querySelector("#birthday_error")?v.insertAdjacentHTML("afterbegin",'<p id="birthday_error" class="form__error">La data di nascita deve essere minore o uguale a quella attuale</p>'):new Date(q.value)<new Date&&v.querySelector("#birthday_error")&&v.querySelector("#birthday_error").remove()})),g.addEventListener("focus",(()=>{y.querySelector("#different_password_error")&&y.querySelector("#different_password_error").remove()})),g.addEventListener("blur",(()=>{g.value.length<8&&!y.querySelector("#password_len_error")?y.insertAdjacentHTML("afterbegin",'<p id="password_len_error" class="form__error">La password deve essere lunga almeno 8 caratteri</p>'):g.value.length>=8&&y.querySelector("#password_len_error")&&y.querySelector("#password_len_error").remove(),w.value!=g.value&&w.value&&!y.querySelector("#different_password_error")?y.insertAdjacentHTML("afterbegin",'<p id="different_password_error" class="form__error">Le password inserite sono differenti</p>'):w.value==g.value&&y.querySelector("#different_password_error")&&y.querySelector("#different_password_error").remove()})),w.addEventListener("focus",(()=>{y.querySelector("#different_password_error")&&y.querySelector("#different_password_error").remove()})),w.addEventListener("blur",(()=>{w.value==g.value||y.querySelector("#different_password_error")?w.value==g.value&&y.querySelector("#different_password_error")&&y.querySelector("#different_password_error").remove():y.insertAdjacentHTML("afterbegin",'<p id="different_password_error" class="form__error">Le password inserite sono differenti</p>')}))}const buyForm=document.querySelector(".js-buy__form");if(buyForm){const b=buyForm.querySelector("#name"),h=buyForm.querySelector("#surname"),F=buyForm.querySelector("#email"),E=buyForm.querySelector("#birthday"),A=document.querySelector("#numero_carta"),j=buyForm.querySelector("#cvv"),M=buyForm.querySelector("#scadenza_carta"),T=/^(?!.*\.\.)[a-zA-Z0-9]+([._]*[a-zA-Z0-9])*@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;b.addEventListener("blur",(()=>{b.value||buyForm.querySelector("#name_error")?b.value&&buyForm.querySelector("#name_error")&&buyForm.querySelector("#name_error").remove():buyForm.insertAdjacentHTML("afterbegin",'<p id="name_error" class="form__error">Inserisci il tuo nome</p>')})),h.addEventListener("blur",(()=>{h.value||buyForm.querySelector("#surname_error")?h.value&&buyForm.querySelector("#surname_error")&&buyForm.querySelector("#surname_error").remove():buyForm.insertAdjacentHTML("afterbegin",'<p id="surname_error" class="form__error">Inserisci il tuo cognome</p>')})),F.addEventListener("blur",(()=>{T.test(F.value)||buyForm.querySelector("#email_error")?T.test(F.value)&&buyForm.querySelector("#email_error")&&buyForm.querySelector("#email_error").remove():buyForm.insertAdjacentHTML("afterbegin",'<p id="email_error" class="form__error">Inserisci un indirizzo email valido</p>')})),E.addEventListener("blur",(()=>{new Date(E.value)>=new Date&&!buyForm.querySelector("#birthday_error")?buyForm.insertAdjacentHTML("afterbegin",'<p id="birthday_error" class="form__error">La data di nascita deve essere minore o uguale a quella attuale</p>'):new Date(E.value)<new Date&&buyForm.querySelector("#birthday_error")&&buyForm.querySelector("#birthday_error").remove()}));const D=/^[0-9]{3}$/;function validateDate(){const e=/^(0[1-9]|1[0-2])\/\d{2}$/,[r,t]=M.value.split("/"),o=(new Date).getFullYear().toString().slice(-2),a=((new Date).getMonth()+1).toString().padStart(2,"0");return e.test(M)||!(t<o||t===o&&r<a)||buyForm.querySelector("#card_date__error")?e.test(M)&&!(t<o||t===o&&r<a)&&buyForm.querySelector("#card_date__error")&&buyForm.querySelector("#card_date__error").remove():buyForm.insertAdjacentHTML("afterbegin",'<p id="card_date__error" class="form__error">Data non valida<p>'),!0}function validateCard(){const e=A.value.replace(/\s/g,""),r=/^[0-9]{16}$/;r.test(e)||isValidLuhn(e)||buyForm.querySelector("#card__error")?r.test(e)&&buyForm.querySelector("#card__error")&&buyForm.querySelector("#card__error").remove():buyForm.insertAdjacentHTML("afterbegin",'<p id="card__error" class="form__error">Numero di carta non valido<p>')}function formatCardNumber(e){return e.replace(/(\d{4})(?=\d)/g,"$1 ")}j.addEventListener("blur",(()=>{D.test(j.value)||buyForm.querySelector("#cvv_error")?D.test(j.value)&&buyForm.querySelector("#cvv_error")&&buyForm.querySelector("#cvv_error").remove():buyForm.insertAdjacentHTML("afterbegin",'<p id="cvv_error" class="form__error">Inserisci un codice CVV valido</p>')})),j.addEventListener("input",(()=>{j.value.length>3&&(j.value=j.value.slice(0,3))})),M.addEventListener("blur",validateDate),M.addEventListener("input",(e=>{isNaN(e.data)&&(M.value=M.value.slice(0,-1)),M.value.length>5&&(M.value=M.value.slice(0,5));const r=M.value.replace(/\D/g,"");M.value=r.slice(0,2)+(r.length>=2?"/"+r.slice(2,4):"")})),A.addEventListener("blur",validateCard),A.addEventListener("input",(e=>{isNaN(e.data)&&(A.value=A.value.slice(0,-1)),A.value.length>19&&(A.value=A.value.slice(0,19)),A.value=formatCardNumber(A.value)}))}