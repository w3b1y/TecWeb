const navMenu=document.querySelector(".js-nav__menu"),navToggle=document.querySelector(".js-nav__toggle"),navClose=document.querySelector(".js-nav__close"),navLink=document.querySelectorAll(".js-nav__item");navToggle&&navToggle.addEventListener("click",(()=>{navMenu.classList.remove("hide-menu"),navMenu.classList.add("show-menu")})),navClose&&navClose.addEventListener("click",(()=>{navMenu.classList.add("hide-menu"),navMenu.classList.remove("show-menu")}));const linkAction=()=>{navMenu.classList.remove("show-menu")};navLink.forEach((e=>e.addEventListener("click",linkAction))),window.addEventListener("scroll",(()=>{this.scrollY>20?document.querySelector(".js-back2top").classList.add("show"):document.querySelector(".js-back2top").classList.remove("show")}));const back2top=document.querySelector(".js-back2top");back2top.addEventListener("click",(()=>{window.scrollTo(0,0)}));const url=new URL(window.location.href),successMessage=document.querySelector(".js-success-message"),searchForm=document.querySelector(".js-container__form--search"),searchSwap=document.querySelector("#swap"),searchFrom=document.querySelector("#from"),searchTo=document.querySelector("#to"),searchDiscount=document.querySelector("#discount"),searchDate=document.querySelector("#date"),searchSeats=document.querySelector("#seats");successMessage&&setTimeout((function(){successMessage&&successMessage.parentNode&&successMessage.parentNode.removeChild(successMessage)}),5e3),searchForm&&(searchSwap.addEventListener("click",(e=>{e.preventDefault();let r=document.querySelector("#from").value,t=document.querySelector("#to").value;r&&t&&(document.querySelector("#from").value=t,document.querySelector("#to").value=r)})),searchFrom.addEventListener("blur",(()=>{searchForm.querySelector("#departure_station_error")?searchForm.querySelector("#departure_station_error").remove():searchForm.querySelector("#departure_station_empty")&&searchForm.querySelector("#departure_station_empty").remove()})),searchTo.addEventListener("blur",(()=>{searchForm.querySelector("#arrival_station_error")?searchForm.querySelector("#arrival_station_error").remove():searchForm.querySelector("#arrival_station_empty")&&searchForm.querySelector("#arrival_station_empty").remove()})),searchDate.addEventListener("blur",(()=>{new Date(searchDate.value)>new Date&&searchForm.querySelector("#datetime_error")?searchForm.querySelector("#datetime_error").remove():new Date(searchDate.value)<=new Date&&!searchForm.querySelector("#datetime_error")&&searchForm.insertAdjacentHTML("afterbegin",'<p id="datetime_error" class="form__error">La data e l&#39;ora devono essere maggiori o uguali a quelli attuali</p>')})),url.searchParams.get("discount_code")&&(searchDiscount.value=url.searchParams.get("discount_code")),url.searchParams.get("min_people")&&(searchSeats.value=url.searchParams.get("min_people")),searchDiscount.addEventListener("focus",(e=>{e.preventDefault(),searchForm.querySelector("#discount_error")&&searchForm.querySelector("#discount_error").remove()})),searchSeats.addEventListener("input",(e=>{e.preventDefault();let r=parseInt(searchSeats.value,10);(isNaN(r)||r<1||r>35)&&(searchSeats.value=Math.min(35,Math.max(1,r)))})));const newsCard=document.querySelectorAll(".js-news");newsCard.forEach((e=>{let r=e.querySelector(".js-news__expand"),t=e.querySelector(".js-news__content");r.addEventListener("click",(()=>{t.classList.toggle("show"),r.classList.toggle("rotate"),r.classList.contains("rotate")?r.setAttribute("aria-label","Riduci la notizia"):r.setAttribute("aria-label","Espandi la notizia")}))}));const tickets=document.querySelectorAll(".js-ticket");tickets&&tickets.forEach((e=>{const r=e.querySelector(".js-news__expand"),t=e.querySelector(".js-ticket__body"),o=e.querySelector(".js-submit");r.addEventListener("click",(()=>{t.classList.toggle("ticket__body--reduced"),r.classList.toggle("rotate"),r.classList.contains("rotate")?r.setAttribute("aria-label","Riduci il biglietto"):r.setAttribute("aria-label","Espandi il biglietto")}));const a=e.querySelector(".js-first__class"),s=e.querySelector(".js-second__class"),n=e.querySelector(".js-submit");a.addEventListener("click",(()=>{a.classList.add("ticket__class--selected"),s.classList.remove("ticket__class--selected"),n.innerHTML=`€${n.dataset.firstclass}`,n.dataset.class=1})),s.addEventListener("click",(()=>{s.classList.add("ticket__class--selected"),a.classList.remove("ticket__class--selected"),n.innerHTML=`€${n.dataset.secondclass}`,n.dataset.class=2})),o.addEventListener("click",(()=>{const r=new URLSearchParams;r.append("schedule",o.dataset.schedule),r.append("class",o.dataset.class),r.append("price",1==o.dataset.class?n.dataset.firstclass:n.dataset.secondclass),r.append("departure_time",e.querySelector(".js-departure_time").innerHTML),r.append("arrival_time",e.querySelector(".js-arrival_time").innerHTML),fetch(window.location.href,{method:"POST",body:r}).then((e=>{if(!e.ok)throw new Error("Network response was not ok.");window.location.href="./buy.php"}))}))}));const overviewButton=document.querySelector("#overview"),overviewPage=document.querySelector("#page--overview"),historyButton=document.querySelector("#history"),historyPage=document.querySelector("#page--history"),userButton=document.querySelector("#user"),userPage=document.querySelector("#page--user");function showPageUser(e,r){overviewPage.classList.add("container--hide"),historyPage.classList.add("container--hide"),userPage.classList.add("container--hide"),overviewButton.classList.remove("nav__button--current"),historyButton.classList.remove("nav__button--current"),userButton.classList.remove("nav__button--current"),r.classList.remove("container--hide"),e.classList.add("nav__button--current"),localStorage.setItem("userPage",e.id)}if(overviewButton&&historyButton&&userButton){overviewButton.addEventListener("click",(()=>showPageUser(overviewButton,overviewPage))),historyButton.addEventListener("click",(()=>showPageUser(historyButton,historyPage))),userButton.addEventListener("click",(()=>showPageUser(userButton,userPage)));const e=document.querySelector("#form--user-data"),r=e.querySelector(".js-register__form--pinfo"),t=e.querySelector(".js-register__form--pwd"),o=e.querySelector("#name"),a=e.querySelector("#surname"),s=e.querySelector("#email"),n=e.querySelector("#birthday"),l=e.querySelector("#old_password"),u=e.querySelector("#new_password"),c=e.querySelector("#rnew_password"),i=e.querySelector(".submit"),d=/^(?!.*\.\.)[a-zA-Z0-9]+([._]*[a-zA-Z0-9])*@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;o.addEventListener("blur",(()=>{o.value||r.querySelector("#name_error")?o.value&&r.querySelector("#name_error")&&r.querySelector("#name_error").remove():r.insertAdjacentHTML("afterbegin",'<p aria-role="alert" id="name_error" class="form__error">Inserisci il tuo nome</p>')})),a.addEventListener("blur",(()=>{a.value||r.querySelector("#surname_error")?a.value&&r.querySelector("#surname_error")&&r.querySelector("#surname_error").remove():r.insertAdjacentHTML("afterbegin",'<p aria-role="alert" id="surname_error" class="form__error">Inserisci il tuo cognome</p>')})),s.addEventListener("blur",(()=>{d.test(s.value)||r.querySelector("#email_error")?d.test(s.value)&&r.querySelector("#email_error")&&r.querySelector("#email_error").remove():r.insertAdjacentHTML("afterbegin",'<p aria-role="alert" id="email_error" class="form__error">Inserisci un indirizzo email valido</p>')})),n.addEventListener("blur",(()=>{new Date(n.value)>=new Date&&!r.querySelector("#birthday_error")?r.insertAdjacentHTML("afterbegin",'<p aria-role="alert" id="birthday_error" class="form__error">La data di nascita deve essere minore o uguale a quella attuale</p>'):new Date(n.value)<new Date&&r.querySelector("#birthday_error")&&r.querySelector("#birthday_error").remove()})),l.addEventListener("blur",(()=>{l.value&&l.value.length<8&&!t.querySelector("#password_len_error")?t.insertAdjacentHTML("afterbegin",'<p aria-role="alert" id="password_len_error" class="form__error">La password deve essere lunga almeno 8 caratteri</p>'):l.value.length>=8&&t.querySelector("#password_len_error")&&t.querySelector("#password_len_error").remove()})),u.addEventListener("blur",(()=>{u.value&&u.value.length<8&&!t.querySelector("#password_len_error")?t.insertAdjacentHTML("afterbegin",'<p aria-role="alert" id="password_len_error" class="form__error">La password deve essere lunga almeno 8 caratteri</p>'):u.value.length>=8&&t.querySelector("#password_len_error")&&t.querySelector("#password_len_error").remove(),c.value!=u.value&&c.value&&!t.querySelector("#different_password_error")?t.insertAdjacentHTML("afterbegin",'<p aria-role="alert" id="different_password_error" class="form__error">Le password inserite sono differenti</p>'):c.value==u.value&&t.querySelector("#different_password_error")&&t.querySelector("#different_password_error").remove()})),c.addEventListener("blur",(()=>{c.value==u.value||t.querySelector("#different_password_error")?c.value==u.value&&t.querySelector("#different_password_error")&&t.querySelector("#different_password_error").remove():t.insertAdjacentHTML("afterbegin",'<p aria-role="alert" id="different_password_error" class="form__error">Le password inserite sono differenti</p>')})),i.addEventListener("click",(r=>{e.querySelector(".form__error")&&r.preventDefault()}))}const addNewsButton=document.querySelector("#addNews"),addNewsPage=document.querySelector("#page--addNews"),removeNewsButton=document.querySelector("#removeNews"),removeNewsPage=document.querySelector("#page--removeNews"),addOfferButton=document.querySelector("#addOffer"),addOfferPage=document.querySelector("#page--addOffer"),removeOfferButton=document.querySelector("#removeOffer"),removeOfferPage=document.querySelector("#page--removeOffer");function showPageAdmin(e,r){addNewsPage.classList.add("container--hide"),removeNewsPage.classList.add("container--hide"),addOfferPage.classList.add("container--hide"),removeOfferPage.classList.add("container--hide"),addNewsButton.classList.remove("nav__button--current"),removeNewsButton.classList.remove("nav__button--current"),addOfferButton.classList.remove("nav__button--current"),removeOfferButton.classList.remove("nav__button--current"),r.classList.remove("container--hide"),e.classList.add("nav__button--current"),localStorage.setItem("adminPage",e.id)}if(addNewsButton&&addOfferButton){console.log(addNewsButton),addNewsButton.addEventListener("click",(()=>showPageAdmin(addNewsButton,addNewsPage))),removeNewsButton.addEventListener("click",(()=>showPageAdmin(removeNewsButton,removeNewsPage))),addOfferButton.addEventListener("click",(()=>showPageAdmin(addOfferButton,addOfferPage))),removeOfferButton.addEventListener("click",(()=>showPageAdmin(removeOfferButton,removeOfferPage)));const m=document.querySelector("#form--insert-news"),_=m.querySelector("#news__date--start"),v=m.querySelector("#news__date--end"),y=m.querySelector("#news__title"),S=m.querySelector("#news__content");m.querySelector(".submit");_.addEventListener("blur",(()=>{_.value&&m.querySelector("#initial_date_empty")&&m.querySelector("#initial_date_empty").remove(),_.value&&v.value&&new Date(_.value)<new Date(v.value)&&m.querySelector("#datetime_error")&&m.querySelector("#datetime_error").remove()})),v.addEventListener("blur",(()=>{v.value&&m.querySelector("#final_date_empty")&&m.querySelector("#final_date_empty").remove(),_.value&&v.value&&new Date(_.value)<new Date(v.value)&&m.querySelector("#datetime_error")&&m.querySelector("#datetime_error").remove()})),y.addEventListener("blur",(()=>{v.value&&m.querySelector("#title_empty")&&m.querySelector("#title_empty").remove()})),S.addEventListener("blur",(()=>{S.value&&m.querySelector("#content_empty")&&m.querySelector("#content_empty").remove()}));const f=document.querySelector("#form--insert-offer"),q=f.querySelector("#offer__title"),g=f.querySelector("#offer__content"),p=f.querySelector("#offer__discount-code"),w=f.querySelector("#offer__discount-percentage"),L=f.querySelector("#offer__date--end"),b=f.querySelector("#offer__min-people");q.addEventListener("blur",(()=>{L.value&&f.querySelector("#offer__error--title")&&f.querySelector("#offer__error--title").remove()})),g.addEventListener("blur",(()=>{g.value&&f.querySelector("#offer__error--content")&&f.querySelector("#offer__error--content").remove()})),p.addEventListener("blur",(()=>{p.value&&f.querySelector("#offer__error--discount-code")&&f.querySelector("#offer__error--discount-code").remove()})),w.addEventListener("blur",(()=>{w.value&&f.querySelector("#offer__error--discount-percentage")&&f.querySelector("#offer__error--discount-percentage").remove()})),L.addEventListener("blur",(()=>{L.value&&f.querySelector("#offer__error--end-date")&&f.querySelector("#offer__error--end-date").remove()})),b.addEventListener("blur",(()=>{b.value&&f.querySelector("#offer__error--min-people")&&f.querySelector("#offer__error--min-people").remove()}))}window.onload=()=>{if(window.location.href.includes("adminpage")&&localStorage.getItem("adminPage")){let e=localStorage.getItem("adminPage");document.querySelector(`#${e}`).click()}else if(window.location.href.includes("userpage")&&localStorage.getItem("userPage")){let e=localStorage.getItem("userPage");document.querySelector(`#${e}`).click()}};const loginForm=document.querySelector(".js-login__form");if(loginForm){const h=loginForm.querySelector("#user_name"),F=loginForm.querySelector("#new_password");h.addEventListener("blur",(()=>{h.value&&loginForm.querySelector("#username_error")&&loginForm.querySelector("#username_error").remove()})),h.addEventListener("focus",(()=>{F.value&&loginForm.querySelector("#login_error")&&loginForm.querySelector("#login_error").remove()})),F.addEventListener("blur",(()=>{"admin"!=F.value&&"user"!=F.value&&(F.value&&F.value.length<8&&!loginForm.querySelector("#password_error")?loginForm.insertAdjacentHTML("afterbegin",'<p aria-role="alert" id="password_error" class="form__error">La password deve essere lunga almeno 8 caratteri</p>'):F.value.length>=8&&loginForm.querySelector("#password_error")&&loginForm.querySelector("#password_error").remove())})),F.addEventListener("focus",(()=>{h.value&&loginForm.querySelector("#login_error")&&loginForm.querySelector("#login_error").remove()}))}const registerForm=document.querySelector(".js-register__form");if(registerForm){const E=registerForm.querySelector(".js-register__form--pinfo"),j=registerForm.querySelector(".js-register__form--pwd"),k=registerForm.querySelector("#username"),A=registerForm.querySelector("#name"),P=registerForm.querySelector("#surname"),M=registerForm.querySelector("#email"),B=registerForm.querySelector("#birthday"),D=registerForm.querySelector("#new_password"),N=registerForm.querySelector("#rnew_password"),T=/^(?!.*\.\.)[a-zA-Z0-9]+([._]*[a-zA-Z0-9])*@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;k.addEventListener("blur",(()=>{k.value&&E.querySelector("#username_error")&&E.querySelector("#username_error").remove()})),A.addEventListener("blur",(()=>{A.value&&E.querySelector("#name_error")&&E.querySelector("#name_error").remove()})),P.addEventListener("blur",(()=>{P.value&&E.querySelector("#surname_error")&&E.querySelector("#surname_error").remove()})),M.addEventListener("blur",(()=>{!M.value||T.test(M.value)||E.querySelector("#email_error")?T.test(M.value)&&E.querySelector("#email_error")&&E.querySelector("#email_error").remove():E.insertAdjacentHTML("afterbegin",'<p aria-role="alert" id="email_error" class="form__error">Inserisci un indirizzo email valido</p>')})),B.addEventListener("blur",(()=>{new Date(B.value)<new Date&&E.querySelector("#birthday_error")&&E.querySelector("#birthday_error").remove()})),D.addEventListener("focus",(()=>{j.querySelector("#different_password_error")&&j.querySelector("#different_password_error").remove()})),D.addEventListener("blur",(()=>{D.value&&D.value.length<8&&!j.querySelector("#password_len_error")?j.insertAdjacentHTML("afterbegin",'<p aria-role="alert" id="password_len_error" class="form__error">La password deve essere lunga almeno 8 caratteri</p>'):D.value.length>=8&&j.querySelector("#password_len_error")&&j.querySelector("#password_len_error").remove(),N.value!=D.value&&N.value&&!j.querySelector("#different_password_error")?j.insertAdjacentHTML("afterbegin",'<p aria-role="alert" id="different_password_error" class="form__error">Le password inserite sono differenti</p>'):N.value==D.value&&j.querySelector("#different_password_error")&&j.querySelector("#different_password_error").remove()})),N.addEventListener("blur",(()=>{N.value==D.value||j.querySelector("#different_password_error")?N.value==D.value&&j.querySelector("#different_password_error")&&j.querySelector("#different_password_error").remove():j.insertAdjacentHTML("afterbegin",'<p aria-role="alert" id="different_password_error" class="form__error">Le password inserite sono differenti</p>')}))}const buyForm=document.querySelector(".js-buy__form");if(buyForm){const z=buyForm.querySelector("#name"),H=buyForm.querySelector("#surname"),O=buyForm.querySelector("#email"),I=buyForm.querySelector("#birthday"),Z=document.querySelector("#numero_carta"),$=buyForm.querySelector("#cvv"),C=buyForm.querySelector("#scadenza_carta"),U=/^(?!.*\.\.)[a-zA-Z0-9]+([._]*[a-zA-Z0-9])*@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;z.addEventListener("blur",(()=>{z.value&&buyForm.querySelector("#name_error")&&buyForm.querySelector("#name_error").remove()})),H.addEventListener("blur",(()=>{H.value&&buyForm.querySelector("#surname_error")&&buyForm.querySelector("#surname_error").remove()})),O.addEventListener("blur",(()=>{!O.value||U.test(O.value)||buyForm.querySelector("#email_error")?U.test(O.value)&&buyForm.querySelector("#email_error")&&buyForm.querySelector("#email_error").remove():buyForm.insertAdjacentHTML("afterbegin",'<p aria-role="alert" id="email_error" class="form__error">Inserisci un indirizzo email valido</p>')})),I.addEventListener("blur",(()=>{new Date(I.value)<new Date&&buyForm.querySelector("#birthday_error")&&buyForm.querySelector("#birthday_error").remove()}));const R=/^[0-9]{3}$/;function validateDate(){const e=/^(0[1-9]|1[0-2])\/\d{2}$/,[r,t]=C.value.split("/"),o=(new Date).getFullYear().toString().slice(-2),a=((new Date).getMonth()+1).toString().padStart(2,"0");return e.test(C)||!(t<o||t===o&&r<a)||buyForm.querySelector("#card_date__error")?e.test(C)&&!(t<o||t===o&&r<a)&&buyForm.querySelector("#card_date__error")&&buyForm.querySelector("#card_date__error").remove():buyForm.insertAdjacentHTML("afterbegin",'<p aria-role="alert" id="card_date__error" class="form__error">Data non valida<p>'),!0}function validateCard(){const e=Z.value.replace(/\s/g,"");/^[0-9]{16}$/.test(e)&&buyForm.querySelector("#card__error")&&buyForm.querySelector("#card__error").remove()}function formatCardNumber(e){return e.replace(/(\d{4})(?=\d)/g,"$1 ")}$.addEventListener("blur",(()=>{R.test($.value)&&buyForm.querySelector("#cvv_error")&&buyForm.querySelector("#cvv_error").remove()})),$.addEventListener("input",(()=>{$.value.length>3&&($.value=$.value.slice(0,3))})),C.addEventListener("blur",validateDate),C.addEventListener("input",(e=>{isNaN(e.data)&&(C.value=C.value.slice(0,-1)),C.value.length>5&&(C.value=C.value.slice(0,5));const r=C.value.replace(/\D/g,"");C.value=r.slice(0,2)+(r.length>=2?"/"+r.slice(2,4):"")})),Z.addEventListener("blur",validateCard),Z.addEventListener("input",(e=>{isNaN(e.data)&&(Z.value=Z.value.slice(0,-1)),Z.value.length>19&&(Z.value=Z.value.slice(0,19)),Z.value=formatCardNumber(Z.value)}))}